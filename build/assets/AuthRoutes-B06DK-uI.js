import{c as G,j as e,u as O,r as m,a as $,B as y,O as M,b as F,d as U,s as V,p as q,e as B,f as E,g as z,h as P,T as C,i as v,k as H,l as J,m as K,n as k,S as Q,R as X,o as R,N as _}from"./index-Btfg9Eos.js";import{v as A,a as I,T as L,P as W,b as Y,c as Z,C as ee}from"./PasswordField-CX9OBBmP.js";import{D as se}from"./Grow-D7lEDyQO.js";const ae=G(e.jsx("path",{d:"M12.545,10.239v3.821h5.445c-0.712,2.315-2.647,3.972-5.445,3.972c-3.332,0-6.033-2.701-6.033-6.032s2.701-6.032,6.033-6.032c1.498,0,2.866,0.549,3.921,1.453l2.814-2.814C17.503,2.988,15.139,2,12.545,2C7.021,2,2.543,6.477,2.543,12s4.478,10,10.002,10c8.396,0,10.249-7.85,9.426-11.748L12.545,10.239z"}),"Google"),te=()=>{const n=O(),[s,a]=m.useState(!1);return m.useEffect(()=>{$()?(console.log("checkUserToken"),a(!0),n("/user",{replace:!0})):a(!1)},[n]),e.jsx(e.Fragment,{children:!s&&e.jsx(y,{sx:{display:"grid",placeItems:"center",flex:1,height:"70vh"},children:e.jsx(y,{sx:{minWidth:"max(20vw, 350px)",width:"350px",p:3,border:1,px:4,borderColor:"primary.main",borderRadius:2,textAlign:"center"},children:e.jsx(M,{})})})})},ne=n=>{const s={};let a=!0;const r=A(n.email);r.isValid||(a=!1,s.email=r.err.email);const t=I(n.password);return t.isValid||(a=!1,s.password=t.err.password),{isValid:a,err:s}},ie=()=>{const n=O(),s=F(),{loginDetailPreserve:a,isLoading:r}=U(o=>o.auth),[t,l]=m.useState({email:"",password:""}),[c,g]=m.useState({}),T=o=>{const{name:i,value:d}=o.target;i==="phone_number"&&d.length>10||(l(x=>({...x,[i]:d})),g(x=>({...x,[i]:""})))},w=async o=>{o.preventDefault();const i=ne(t);if(i.isValid){s(V(t));try{const S=await s(q(t)).unwrap();S!=null&&S.data?(await B(S.data),E({message:S.message}),n("/user",{replace:!0}),s(V(null))):z({message:"Unexpected response: Missing data"})}catch(d){d!=null&&d.message&&console.warn(d==null?void 0:d.message)}}else g(i.err)},j=async()=>{s(V(t));const o=A(t.email);if(o.isValid)try{const i={email:t.email},x=await s(P(i)).unwrap();E({message:x.message,duration:3e3}),n("/user/auth/verify_otp",{state:{userdata:t,action:"forgetpassword"}})}catch(i){i!=null&&i.message&&console.warn(i==null?void 0:i.message)}else g(o.err)},h=async()=>{s(V(t)),n("/user/auth/registration")};return m.useEffect(()=>{a&&l(a)},[a]),{veriabls:{loginDetails:t,loginDetailsErr:c,isLoading:r},methods:{handleLoginDetailsChange:T,handleSubmit:w,handleForgotPassword:j,handleRegistration:h}}},N=({title:n,subtitle:s,children:a})=>e.jsxs(y,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(C,{variant:"subtitle1",fontWeight:"bold",color:"primary.dark",children:[n,e.jsx(C,{variant:"body1",color:"primary.main",children:s})]}),a]}),re=()=>{const{veriabls:{loginDetails:n,loginDetailsErr:s,isLoading:a},methods:{handleLoginDetailsChange:r,handleSubmit:t,handleForgotPassword:l,handleRegistration:c}}=ie();return console.log(a),e.jsxs(N,{title:"Log in to E-Commerce",subtitle:"Enter your details below",children:[e.jsx("form",{onSubmit:t,children:e.jsxs(y,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(L,{variant:"standard",fullWidth:!0,autoFocus:!0,label:"Email",name:"email",type:"email",value:n.email,onChange:r,error:!!s.email,helperText:s.email}),e.jsx(W,{value:n.password,onChange:r,error:!!s.password,helperText:s.password}),e.jsx(y,{sx:{display:"flex",justifyContent:"end"},children:e.jsx(v,{variant:"text",color:"primary",sx:{py:"1px"},onClick:l,disabled:a,children:"Forgot password?"})}),e.jsx(v,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",disabled:a,children:"Log In"})]})}),e.jsx(se,{children:e.jsx(C,{variant:"body1",color:"primary.main",children:"Or, Login with"})}),e.jsx(v,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(ae,{}),children:"Sign in with Google"}),e.jsxs(C,{variant:"body1",children:["Donâ€™t have an account?",e.jsx(v,{variant:"text",color:"primary",sx:{py:"1px",ml:.5},onClick:c,children:"Register here"})]})]})},oe=()=>{const n=O(),s=H(),a=F(),r=s.state.userdata,t=s.state.action,l=5,[c,g]=m.useState({otp:"",password:""}),[T,w]=m.useState({}),[j,h]=m.useState(l),[o,i]=m.useState(!0);return m.useEffect(()=>{if(o&&j>0){const p=setInterval(()=>h(f=>f-1),1e3);return()=>clearInterval(p)}},[o,j]),{veriabls:{validationData:c,validationDataErr:T,userdata:r,actiontype:t,timer:j},methods:{handleChange:p=>{const{name:f,value:b}=p.target;f==="otp"&&b.length>6||(g(u=>({...u,[f]:b})),w(u=>({...u,[f]:""})))},handleSubmit:async p=>{p.preventDefault();const f=Y(c.otp);if(!f.isValid){w(u=>({...u,otp:f.err.otp??""}));return}if(t==="forgetpassword"){const u=I(c.password??"");if(!u.isValid){w(D=>({...D,password:u.err.password??""}));return}}const b=t==="forgetpassword"?{email:r.email,password:c.password,otp:c.otp}:{otp:c.otp,...r};try{const D=await a(t==="forgetpassword"?J(b):K(b)).unwrap();t!=="forgetpassword"&&(D!=null&&D.data)?(await B(D.data),n("/user",{replace:!0})):t==="forgetpassword"&&n("/user/auth/login",{replace:!0}),E({message:D.message}),a(V(null)),a(k(null))}catch(u){console.warn(u==null?void 0:u.message)}},handleResendOtp:async()=>{try{const p={email:r.email},b=await a(P(p)).unwrap();E({message:b.message,duration:3e3}),h(l),i(!0)}catch(p){p!=null&&p.message&&console.warn(p==null?void 0:p.message)}}}}},le=()=>{const{veriabls:{validationData:n,validationDataErr:s,userdata:a,actiontype:r,timer:t},methods:{handleChange:l,handleSubmit:c,handleResendOtp:g}}=oe();return e.jsx(N,{title:"Verification",subtitle:`Otp sent successfully to your number ${a.email}`,children:e.jsx("form",{onSubmit:c,children:e.jsxs(y,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(L,{autoFocus:!0,variant:"standard",label:"Otp",name:"otp",type:"number",value:n.otp,onChange:l,error:!!s.otp,helperText:s.otp,sx:{}}),r==="forgetpassword"&&e.jsx(W,{value:n==null?void 0:n.password,onChange:l,error:!!s.password,helperText:s.password}),e.jsx(y,{sx:{display:"flex",justifyContent:"end"},children:t?e.jsxs(C,{variant:"body1",sx:{},children:["Resend OTP in ",t>0&&`${t} sec`]}):e.jsx(v,{type:"button",onClick:g,disabled:t>0,sx:{},children:"Resend OTP"})}),e.jsx(v,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",children:"Submit"})]})})})},de=n=>{const s={};let a=!0;const r=Z(n.name);r.isValid||(a=!1,s.name=r.err.name);const t=A(n.email);t.isValid||(a=!1,s.email=t.err.email);const l=I(n.password);return l.isValid||(a=!1,s.password=l.err.password),{isValid:a,err:s}},ce=()=>{const n=O(),s=F(),{registerDetailPreserve:a}=U(h=>h.auth),[r,t]=m.useState({name:"",email:"",password:""}),[l,c]=m.useState({}),g=h=>{const{name:o,value:i}=h.target;o==="phone_number"&&i.length>10||(t(d=>({...d,[o]:i})),c(d=>({...d,[o]:""})))},T=async h=>{h.preventDefault();const o=de(r);if(o.isValid){s(k(r));try{const i={email:r.email},x=await s(P(i)).unwrap();E({message:x.message,duration:3e3}),n("/user/auth/verify_otp",{state:{userdata:r,action:"registration"}})}catch(i){i!=null&&i.message&&console.warn(i==null?void 0:i.message)}}else c(o.err)},w=()=>{s(k(r)),n("/user/auth/login")},j=()=>{console.log("terms-and-conditions")};return m.useEffect(()=>{a?t(a):console.log("No preserved login.")},[a]),{veriabls:{registrationDetails:r,registrationDetailsErr:l},methods:{handleRegistrationDetailsChange:g,handleSubmit:T,handleLogin:w,handleTermsAndConditions:j}}},pe=()=>{const{veriabls:{registrationDetails:n,registrationDetailsErr:s},methods:{handleRegistrationDetailsChange:a,handleSubmit:r,handleLogin:t,handleTermsAndConditions:l}}=ce();return e.jsxs(N,{title:"Create an account",subtitle:"Enter your details to register.",children:[e.jsx("form",{onSubmit:r,children:e.jsxs(y,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(L,{autoFocus:!0,variant:"standard",fullWidth:!0,label:"Full Name",name:"name",value:n.name,onChange:a,error:!!s.name,helperText:s.name}),e.jsx(L,{variant:"standard",fullWidth:!0,label:"Email",name:"email",type:"email",value:n.email,onChange:a,error:!!s.email,helperText:s.email}),e.jsx(W,{value:n.password,onChange:a,error:!!s.password,helperText:s.password}),e.jsxs(Q,{direction:"row",spacing:0,sx:{p:0},children:[e.jsx(ee,{required:!0,sx:{color:"primary.main",p:0}})," ",e.jsx(v,{variant:"text",color:"primary",sx:{py:"1px"},onClick:l,children:"Terms And Conditions "})]}),e.jsx(v,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",children:"Register"})]})}),e.jsxs(C,{children:["Already have an account?",e.jsx(C,{component:"span",sx:{color:"primary.main",cursor:"pointer",ml:1},onClick:t,children:"Log in here"})]})]})},ge=()=>e.jsx(X,{children:e.jsxs(R,{path:"/",element:e.jsx(te,{}),children:[e.jsx(R,{index:!0,element:e.jsx(_,{to:"/auth/login",replace:!0})}),e.jsx(R,{path:"login",element:e.jsx(re,{})}),e.jsx(R,{path:"registration",element:e.jsx(pe,{})}),e.jsx(R,{path:"verify_otp",element:e.jsx(le,{})}),e.jsx(R,{path:"*",element:e.jsx(_,{to:"/auth/login",replace:!0})})]})});export{ge as default};
