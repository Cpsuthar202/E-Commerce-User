import{u as L,r as p,c as B,j as e,B as f,O as $,a as O,b as _,s as E,l as q,d as U,e as T,f as M,g as F,T as R,h as D,i as z,k as G,m as H,n as k,S as J,R as K,o as C,N}from"./index-DMW1FIza.js";import{v as P,a as A,T as V,P as I,b as Q,c as X,C as Y}from"./PasswordField-DeVqQWap.js";import"./Grow-dAveU-pt.js";const Z=()=>{const t=L(),[s,a]=p.useState(!1);return p.useEffect(()=>{B()?(console.log("checkUserToken"),a(!0),t("/user",{replace:!0})):a(!1)},[t]),e.jsx(e.Fragment,{children:!s&&e.jsx(f,{sx:{display:"grid",placeItems:"center",flex:1,height:"70vh"},children:e.jsx(f,{sx:{minWidth:"max(20vw, 350px)",width:"350px",p:3,border:1,px:4,borderColor:"primary.main",borderRadius:2,textAlign:"center"},children:e.jsx($,{})})})})},ee=t=>{const s={};let a=!0;const r=P(t.email);r.isValid||(a=!1,s.email=r.err.email);const n=A(t.password);return n.isValid||(a=!1,s.password=n.err.password),{isValid:a,err:s}},se=()=>{const t=L(),s=O(),{loginDetailPreserve:a}=_(l=>l.auth),[r,n]=p.useState({email:"",password:""}),[d,c]=p.useState({}),v=l=>{const{name:o,value:i}=l.target;o==="phone_number"&&i.length>10||(n(u=>({...u,[o]:i})),c(u=>({...u,[o]:""})))},S=async l=>{l.preventDefault();const o=ee(r);if(o.isValid){s(E(r));try{const i=r;console.log({payload:i});const g=await s(q(i)).unwrap();g!=null&&g.data?(await U(g.data),T({message:g.message}),console.log(g),t("/user",{replace:!0}),s(E(null))):M({message:"Unexpected response: Missing data"})}catch(i){i!=null&&i.message&&console.log("error.messa ge",i.message)}}else c(o.err)},y=async()=>{s(E(r));const l=P(r.email);if(l.isValid)try{const o={email:r.email},u=await s(F(o)).unwrap();T({message:u.message,duration:3e3}),t("/user/auth/verify_otp",{state:{userdata:r,action:"forgetpassword"}})}catch(o){o!=null&&o.message&&console.log("error.messa ge",o.message)}else c(l.err)},j=async()=>{s(E(r)),t("/user/auth/registration")};return p.useEffect(()=>{a&&n(a)},[a]),{veriabls:{loginDetails:r,loginDetailsErr:d},methods:{handleLoginDetailsChange:v,handleSubmit:S,handleForgotPassword:y,handleRegistration:j}}},W=({title:t,subtitle:s,children:a})=>e.jsxs(f,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(R,{variant:"subtitle1",fontWeight:"bold",color:"primary.dark",children:[t,e.jsx(R,{variant:"body1",color:"primary.main",children:s})]}),a]}),ae=()=>{const{veriabls:{loginDetails:t,loginDetailsErr:s},methods:{handleLoginDetailsChange:a,handleSubmit:r,handleForgotPassword:n,handleRegistration:d}}=se();return e.jsxs(W,{title:"Log in to E-Commerce",subtitle:"Enter your details below",children:[e.jsx("form",{onSubmit:r,children:e.jsxs(f,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(V,{variant:"standard",fullWidth:!0,autoFocus:!0,label:"Email",name:"email",type:"email",value:t.email,onChange:a,error:!!s.email,helperText:s.email}),e.jsx(I,{value:t.password,onChange:a,error:!!s.password,helperText:s.password}),e.jsx(f,{sx:{display:"flex",justifyContent:"end"},children:e.jsx(D,{variant:"text",color:"primary",sx:{py:"1px"},onClick:n,children:"Forgot password?"})}),e.jsx(D,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",children:"Log In"})]})}),e.jsxs(R,{variant:"body1",children:["Donâ€™t have an account?",e.jsx(D,{variant:"text",color:"primary",sx:{py:"1px",ml:.5},onClick:d,children:"Register here"})]})]})},te=()=>{const t=L(),s=z(),a=O(),r=s.state.userdata,n=s.state.action,d=5,[c,v]=p.useState({otp:"",password:""}),[S,y]=p.useState({}),[j,l]=p.useState(d),[o,i]=p.useState(!0);return p.useEffect(()=>{if(o&&j>0){const m=setInterval(()=>l(x=>x-1),1e3);return()=>clearInterval(m)}},[o,j]),{veriabls:{validationData:c,validationDataErr:S,userdata:r,actiontype:n,timer:j},methods:{handleChange:m=>{const{name:x,value:w}=m.target;x==="otp"&&w.length>6||(v(h=>({...h,[x]:w})),y(h=>({...h,[x]:""})))},handleSubmit:async m=>{m.preventDefault();const x=Q(c.otp);if(!x.isValid){y(h=>({...h,otp:x.err.otp??""}));return}if(n==="forgetpassword"){const h=A(c.password??"");if(!h.isValid){y(b=>({...b,password:h.err.password??""}));return}}const w=n==="forgetpassword"?{email:r.email,password:c.password,otp:c.otp}:{otp:c.otp,...r};try{const b=await a(n==="forgetpassword"?G(w):H(w)).unwrap();n!=="forgetpassword"&&(b!=null&&b.data)?(await U(b.data),t("/user",{replace:!0})):n==="forgetpassword"&&t("/user/auth/login",{replace:!0}),T({message:b.message}),a(E(null)),a(k(null))}catch(h){console.error("Error:",h)}},handleResendOtp:async()=>{try{const m={email:r.email},w=await a(F(m)).unwrap();T({message:w.message,duration:3e3}),l(d),i(!0)}catch(m){m!=null&&m.message&&console.log("error.messa ge",m.message)}}}}},re=()=>{const{veriabls:{validationData:t,validationDataErr:s,userdata:a,actiontype:r,timer:n},methods:{handleChange:d,handleSubmit:c,handleResendOtp:v}}=te();return e.jsx(W,{title:"Verification",subtitle:`Otp sent successfully to your number ${a.email}`,children:e.jsx("form",{onSubmit:c,children:e.jsxs(f,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(V,{autoFocus:!0,variant:"standard",label:"Otp",name:"otp",type:"number",value:t.otp,onChange:d,error:!!s.otp,helperText:s.otp,sx:{}}),r==="forgetpassword"&&e.jsx(I,{value:t==null?void 0:t.password,onChange:d,error:!!s.password,helperText:s.password}),e.jsx(f,{sx:{display:"flex",justifyContent:"end"},children:n?e.jsxs(R,{variant:"body1",sx:{},children:["Resend OTP in ",n>0&&`${n} sec`]}):e.jsx(D,{type:"button",onClick:v,disabled:n>0,sx:{},children:"Resend OTP"})}),e.jsx(D,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",children:"Submit"})]})})})},ne=t=>{const s={};let a=!0;const r=X(t.name);r.isValid||(a=!1,s.name=r.err.name);const n=P(t.email);n.isValid||(a=!1,s.email=n.err.email);const d=A(t.password);return d.isValid||(a=!1,s.password=d.err.password),{isValid:a,err:s}},oe=()=>{const t=L(),s=O(),{registerDetailPreserve:a}=_(l=>l.auth),[r,n]=p.useState({name:"",email:"",password:""}),[d,c]=p.useState({}),v=l=>{const{name:o,value:i}=l.target;o==="phone_number"&&i.length>10||(n(u=>({...u,[o]:i})),c(u=>({...u,[o]:""})))},S=async l=>{l.preventDefault(),console.log("juygf");const o=ne(r);if(o.isValid){s(k(r));try{const i={email:r.email},g=await s(F(i)).unwrap();T({message:g.message,duration:3e3}),t("/user/auth/verify_otp",{state:{userdata:r,action:"registration"}})}catch(i){i!=null&&i.message&&console.log("error.messa ge",i.message)}}else c(o.err)},y=()=>{s(k(r)),t("/user/auth/login")},j=()=>{console.log("terms-and-conditions")};return p.useEffect(()=>{a?n(a):console.log("No preserved login.")},[a]),{veriabls:{registrationDetails:r,registrationDetailsErr:d},methods:{handleRegistrationDetailsChange:v,handleSubmit:S,handleLogin:y,handleTermsAndConditions:j}}},ie=()=>{const{veriabls:{registrationDetails:t,registrationDetailsErr:s},methods:{handleRegistrationDetailsChange:a,handleSubmit:r,handleLogin:n,handleTermsAndConditions:d}}=oe();return e.jsxs(W,{title:"Create an account",subtitle:"Enter your details to register.",children:[e.jsx("form",{onSubmit:r,children:e.jsxs(f,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(V,{autoFocus:!0,variant:"standard",fullWidth:!0,label:"Full Name",name:"name",value:t.name,onChange:a,error:!!s.name,helperText:s.name}),e.jsx(V,{variant:"standard",fullWidth:!0,label:"Email",name:"email",type:"email",value:t.email,onChange:a,error:!!s.email,helperText:s.email}),e.jsx(I,{value:t.password,onChange:a,error:!!s.password,helperText:s.password}),e.jsxs(J,{direction:"row",spacing:0,sx:{p:0},children:[e.jsx(Y,{required:!0,sx:{color:"primary.main",p:0}})," ",e.jsx(D,{variant:"text",color:"primary",sx:{py:"1px"},onClick:d,children:"Terms And Conditions "})]}),e.jsx(D,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",children:"Register"})]})}),e.jsxs(R,{children:["Already have an account?",e.jsx(R,{component:"span",sx:{color:"primary.main",cursor:"pointer",ml:1},onClick:n,children:"Log in here"})]})]})},ue=()=>e.jsx(K,{children:e.jsxs(C,{path:"/",element:e.jsx(Z,{}),children:[e.jsx(C,{index:!0,element:e.jsx(N,{to:"/auth/login",replace:!0})}),e.jsx(C,{path:"login",element:e.jsx(ae,{})}),e.jsx(C,{path:"registration",element:e.jsx(ie,{})}),e.jsx(C,{path:"verify_otp",element:e.jsx(re,{})}),e.jsx(C,{path:"*",element:e.jsx(N,{to:"/auth/login",replace:!0})})]})});export{ue as default};
